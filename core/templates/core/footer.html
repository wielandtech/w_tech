<div class="footer">
    <h3>VLAN Technology Services LLC 2025</h3>
    <div class="metrics-container" id="metrics-container">
        <div id="metrics-content">
            <div class="metrics-loading">Loading metrics...</div>
        </div>
    </div>
</div>

<script>
// Fetch and display Netdata metrics
function fetchMetrics() {
    fetch('/api/metrics/')
        .then(response => response.json())
        .then(data => {
            console.log('Metrics response:', data);  // Debug logging
            
            if (data.status === 'unavailable' || data.status === 'error') {
                let errorMsg = 'Metrics temporarily unavailable';
                if (data.error) {
                    errorMsg += ': ' + data.error;
                }
                if (data.errors && data.errors.length > 0) {
                    errorMsg += ' (' + data.errors.join(', ') + ')';
                }
                document.getElementById('metrics-content').innerHTML = 
                    '<div class="metrics-error">' + errorMsg + '</div>';
                return;
            }
            
            let html = '<div class="metrics-grid">';

                   // CPU Card
                   if (data.cpu !== null) {
                       const cpuClass = data.cpu.percentage > 80 ? 'critical' : (data.cpu.percentage > 60 ? 'warning' : '');
                       html += `
                           <div class="metric-card">
                               <div class="metric-label">${data.cpu.description}</div>
                               <div class="metric-value">${data.cpu.percentage}%</div>
                               <div class="metric-detail">${data.cpu.total_cores} cores total</div>
                               <div class="metric-bar">
                                   <div class="metric-bar-fill ${cpuClass}" style="width: ${Math.min(data.cpu.percentage, 100)}%"></div>
                               </div>
                           </div>
                       `;
                   }

                   // Memory Card
                   if (data.memory !== null) {
                       const memoryClass = data.memory.percentage > 85 ? 'critical' : (data.memory.percentage > 70 ? 'warning' : '');
                       html += `
                           <div class="metric-card">
                               <div class="metric-label">${data.memory.description}</div>
                               <div class="metric-value">${data.memory.used_gb} / ${data.memory.total_gb} GB</div>
                               <div class="metric-detail">${data.memory.percentage}%</div>
                               <div class="metric-bar">
                                   <div class="metric-bar-fill ${memoryClass}" style="width: ${Math.min(data.memory.percentage, 100)}%"></div>
                               </div>
                           </div>
                       `;
                   }

                   // Pods Card
                   if (data.pods !== null) {
                       html += `
                           <div class="metric-card">
                               <div class="metric-label">${data.pods.description}</div>
                               <div class="metric-value">${data.pods.count}</div>
                               <div class="metric-detail">running on cluster</div>
                           </div>
                       `;
                   }

                   // Network Card
                   if (data.network !== null) {
                       let networkValue, networkDetail;
                       if (data.network.bandwidth_mbps !== undefined) {
                           // Bandwidth metrics
                           networkValue = `${data.network.bandwidth_mbps} Mbps`;
                           networkDetail = `↑${data.network.sent_mbps} ↓${data.network.received_mbps} Mbps`;
                       } else {
                           // Fallback
                           networkValue = 'N/A';
                           networkDetail = 'metrics unavailable';
                       }

                       html += `
                           <div class="metric-card">
                               <div class="metric-label">${data.network.description}</div>
                               <div class="metric-value">${networkValue}</div>
                               <div class="metric-detail">${networkDetail}</div>
                           </div>
                       `;
                   }

            html += '</div>';
            
            // Add status indicator
            let statusParts = [];
            if (data.nodes_count) {
                const reachable = data.reachable_nodes || 0;
                statusParts.push(reachable + '/' + data.nodes_count + ' nodes');
            }
            if (data.cache_hit) {
                statusParts.push('cached');
            }
            if (data.errors && data.errors.length > 0) {
                statusParts.push(data.errors.length + ' warnings');
            }
            if (statusParts.length > 0) {
                html += '<div class="metrics-status">' + statusParts.join(' • ') + '</div>';
            }
            
            document.getElementById('metrics-content').innerHTML = html;
        })
        .catch(error => {
            console.error('Error fetching metrics:', error);
            document.getElementById('metrics-content').innerHTML = 
                '<div class="metrics-error">Unable to load metrics</div>';
        });
}

// Initial fetch
fetchMetrics();

// Refresh every 5 seconds
setInterval(fetchMetrics, 5000);
</script>